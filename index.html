<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>McGill Course Review</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      /* Hide content initially if we're restoring scroll position */
      body.restoring-scroll {
        visibility: hidden;
      }
    </style>
    <script>
      // Check if we need to restore scroll position
      if (sessionStorage.getItem('indexScrollPos')) {
        document.documentElement.classList.add('restoring-scroll');
      }
    </script>
  </head>

  <body>
    <h1>Review</h1>

    <!-- Courses will be dynamically loaded here -->
    <div id="courses-container"></div>

    <div style="
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: transparent;
        color: #000000;
        text-align: center;
        font-size: 14px;
        font-weight: 300;
        font-family: 'Lora', serif;
        padding: 10px 0;
        ">
        AKCSE
    </div>

    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@500&display=swap" rel="stylesheet">

    <script>
        // Load and display all courses
        fetch('/data/reviews.json')
            .then(response => response.json())
            .then(reviews => {
                // Group by department and get unique courses
                const departments = {};
                const uniqueCourses = new Set();
                
                reviews.forEach(review => {
                    if (!departments[review.department]) {
                        departments[review.department] = [];
                    }
                    
                    // Only add course if we haven't seen it before
                    const courseKey = `${review.department}-${review.courseCode}`;
                    if (!uniqueCourses.has(courseKey)) {
                        uniqueCourses.add(courseKey);
                        departments[review.department].push(review);
                    }
                });

                // Create HTML for each department
                const container = document.getElementById('courses-container');
                Object.keys(departments).sort().forEach(dept => {
                    const section = document.createElement('div');
                    section.className = 'section';
                    
                    const grid = document.createElement('div');
                    grid.className = 'course-grid';
                    
                    departments[dept].sort((a, b) => a.courseCode.localeCompare(b.courseCode)).forEach(course => {
                        const link = document.createElement('a');
                        link.href = `/course-template.html?code=${course.courseCode}`;
                        link.className = 'container';
                        link.textContent = course.courseCode;
                        
                        // Save scroll position before navigating
                        link.addEventListener('click', () => {
                            sessionStorage.setItem('indexScrollPos', window.scrollY);
                        });
                        
                        grid.appendChild(link);
                    });
                    
                    section.appendChild(grid);
                    container.appendChild(section);
                });

                // Restore scroll position AFTER content is loaded
                const savedScrollPos = sessionStorage.getItem('indexScrollPos');
                if (savedScrollPos) {
                    // Restore scroll immediately, then show content
                    window.scrollTo(0, parseInt(savedScrollPos));
                    document.documentElement.classList.remove('restoring-scroll');
                    sessionStorage.removeItem('indexScrollPos');
                }
            })
            .catch(error => console.error('Error loading courses:', error));
    </script>
  </body>
</html>
